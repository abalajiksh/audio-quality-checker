# AudioCheckr Test Suite Documentation

## Overview

This document explains the test file structure and expected detection results for the AudioCheckr audio quality validator.

## Test File Structure

### Full Test Suite (`TestFiles.zip` - ~8.5GB)
Used for **Regression Testing** (weekly CI runs)

```
TestFiles/
├── CleanOrigin/          # Original master recordings
├── CleanTranscoded/      # Honest bit-depth reductions (24→16 bit)
├── Resample96/           # Sample rate changes from 96kHz source
├── Resample192/          # Sample rate changes from 192kHz source  
├── Upscale16/            # 16-bit → 24-bit padding (fake depth)
├── Upscaled/             # Lossy codec → FLAC transcodes
└── MasterScript/         # Complex transcoding chains
```

### Compact Test Suite (`CompactTestFiles.zip` - ~500MB)
Used for **Qualification Testing** (every push/PR)

```
CompactTestFiles/
├── CleanOrigin/          # 2 files
├── CleanTranscoded/      # 2 files
├── Resample96/           # 5 files  
├── Upscale16/            # 2 files
└── Upscaled/             # 8 files
```

## Test Categories & Expected Results

### 1. CleanOrigin - Original Masters

| File | Expected | Reason |
|------|----------|--------|
| `input96.flac` | ✅ PASS | Genuine 24-bit 96kHz master |
| `input192.flac` | ❌ FAIL | 16-bit source in 24-bit container |

**Detection:** `input192.flac` should trigger `BitDepthMismatch`

### 2. CleanTranscoded - Honest Bit Depth Reduction

| File | Expected | Reason |
|------|----------|--------|
| `input96_16bit.flac` | ✅ PASS | Genuinely 16-bit, honestly declared |
| `input192_16bit.flac` | ✅ PASS | Genuinely 16-bit, honestly declared |

**Philosophy:** When a file is honestly transcoded to 16-bit and stored as 16-bit, there's no deception. The detector validates against the *claimed* bit depth.

### 3. Resample96 - Sample Rate Changes from 96kHz

| File | Expected | Reason |
|------|----------|--------|
| `input96_44.flac` | ✅ PASS | Downsampled - genuine data |
| `input96_48.flac` | ✅ PASS | Downsampled - genuine data |
| `input96_88.flac` | ✅ PASS | Downsampled - genuine data |
| `input96_176.flac` | ❌ FAIL | Upsampled - interpolated data |
| `input96_192.flac` | ❌ FAIL | Upsampled - interpolated data |

**Philosophy:** 
- **Downsampling** (96→44/48/88) just discards data, remaining data is genuine
- **Upsampling** (96→176/192) creates interpolated samples that don't exist in original

**Detection:** Upsampled files should trigger `Upsampled` or similar

### 4. Resample192 - Sample Rate Changes from 192kHz (16-bit source)

| File | Expected | Reason |
|------|----------|--------|
| `input192_44.flac` | ❌ FAIL | 16-bit source |
| `input192_48.flac` | ❌ FAIL | 16-bit source |
| `input192_88.flac` | ❌ FAIL | 16-bit source |
| `input192_96.flac` | ❌ FAIL | 16-bit source |
| `input192_176.flac` | ❌ FAIL | 16-bit source |

**Note:** All files inherit the 16-bit source issue from `CleanOrigin/input192.flac`

**Detection:** All should trigger `BitDepthMismatch`

### 5. Upscale16 - Fake Bit Depth (16→24 bit padding)

| File | Expected | Reason |
|------|----------|--------|
| `output96_16bit.flac` | ❌ FAIL | 16-bit data zero-padded to 24-bit |
| `output192_16bit.flac` | ❌ FAIL | 16-bit data zero-padded to 24-bit |

**Philosophy:** Files claim to be 24-bit but only have 16 bits of actual data. The LSBs are zeros.

**Detection:** Should trigger `BitDepthMismatch`

### 6. Upscaled - Lossy Codec Transcodes

#### From 96kHz source (genuine 24-bit):

| File | Expected | Detection |
|------|----------|-----------|
| `input96_mp3.flac` | ❌ FAIL | `Mp3Transcode` |
| `input96_m4a.flac` | ❌ FAIL | `AacTranscode` |
| `input96_opus.flac` | ❌ FAIL | `OpusTranscode` |
| `input96_ogg.flac` | ❌ FAIL | `OggVorbisTranscode` |

#### From 192kHz source (16-bit):

| File | Expected | Detection |
|------|----------|-----------|
| `input192_mp3.flac` | ❌ FAIL | `Mp3Transcode` + `BitDepthMismatch` |
| `input192_m4a.flac` | ❌ FAIL | `AacTranscode` + `BitDepthMismatch` |
| `input192_opus.flac` | ❌ FAIL | `OpusTranscode` + `BitDepthMismatch` |
| `input192_ogg.flac` | ❌ FAIL | `OggVorbisTranscode` + `BitDepthMismatch` |

### 7. MasterScript - Complex Transcoding Chains

Generated by `masterFLAC.ps1` script. All outputs are 24-bit FLAC at 192kHz.

#### test96_* files (from genuine 24-bit source):

| Pattern | Expected | Detection |
|---------|----------|-----------|
| `test96_original.flac` | ✅ PASS | Reference file |
| `test96_16bit_upscaled.flac` | ❌ FAIL | `BitDepthMismatch` |
| `test96_resampled_*_upscaled.flac` | ❌ FAIL | `Upsampled` |
| `test96_mp3_*_upscaled.flac` | ❌ FAIL | `Mp3Transcode` |
| `test96_aac_*_upscaled.flac` | ❌ FAIL | `AacTranscode` |
| `test96_opus_*_upscaled.flac` | ❌ FAIL | `OpusTranscode` |
| `test96_vorbis_*_upscaled.flac` | ❌ FAIL | `OggVorbisTranscode` |
| `test96_*_to_*_upscaled.flac` | ❌ FAIL | Multiple codec signatures |

#### test192_* files (from 16-bit source):

All test192_* files will have `BitDepthMismatch` in addition to any codec-specific issues.

| Pattern | Expected | Detection |
|---------|----------|-----------|
| `test192_original.flac` | ❌ FAIL | `BitDepthMismatch` |
| `test192_mp3_*_upscaled.flac` | ❌ FAIL | `BitDepthMismatch` + `Mp3Transcode` |
| `test192_aac_*_upscaled.flac` | ❌ FAIL | `BitDepthMismatch` + `AacTranscode` |
| ... | ... | ... |

## CI/CD Pipeline

### Qualification Tests (Every Push)
- Downloads: `CompactTestFiles.zip` (~500MB)
- Test file: `qualification_test.rs`
- Coverage: 20 representative files
- Duration: ~2-3 minutes
- Purpose: Quick validation that detector works

### Regression Tests (Weekly)
- Downloads: `TestFiles.zip` (~8.5GB)
- Test file: `regression_test.rs`  
- Coverage: 80+ comprehensive files
- Duration: ~15-20 minutes
- Purpose: Full ground truth validation

## Creating Test Files

### Generate CompactTestFiles.zip:

```powershell
# From directory containing TestFiles/
.\Create-CompactTestFiles.ps1
```

### Generate MasterScript test files:

```powershell
# From empty directory with input96.flac and input192.flac
.\masterFLAC.ps1
```

## Detection Categories

| Defect Type | Description |
|-------------|-------------|
| `BitDepthMismatch` | File claims higher bit depth than actual data |
| `Upsampled` | Sample rate increased via interpolation |
| `Mp3Transcode` | MP3 codec artifacts detected |
| `AacTranscode` | AAC codec artifacts detected |
| `OpusTranscode` | Opus codec artifacts detected |
| `OggVorbisTranscode` | Vorbis codec artifacts detected |
| `SpectralArtifacts` | Generic lossy encoding artifacts |

## Notes on Test Philosophy

1. **Honest transcodes pass**: A file honestly converted to 16-bit and stored as 16-bit is not "fake"
2. **Upsampling is deceptive**: Creating new samples that weren't in the original is misleading
3. **Bit depth padding is deceptive**: Claiming 24-bit when only 16 bits have data is misleading
4. **Lossy-to-lossless is deceptive**: FLAC from MP3 sounds like MP3, not lossless
5. **Source quality matters**: Files from 16-bit source (input192) always fail bit depth checks
